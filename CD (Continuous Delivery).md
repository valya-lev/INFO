# Что такое Continuous Delivery (CD)?  
**Continuous Delivery (CD)** — это практика, при которой код автоматически подготавливается к релизу в продакшн после прохождения всех проверок. Ключевое слово здесь — **подготавливается**. **Код готов** к деплою в любой момент, **но само решение о релизе принимает человек**.

**CD** расширяет идею **CI**. Если **CI** отвечает на вопрос **"работает ли код?**", то **CD** отвечает на вопрос **"готов ли код к релизу?"**.  
Это означает не только прохождение тестов, но и создание артефактов, подготовку окружения, проверку совместимости, генерацию документации — всё, что нужно для безопасного релиза.

Главная цель **CD** — сделать **релизы скучными**. Никакого стресса, никаких ночных дежурств, никакого "а вдруг что-то сломается". Релиз становится обычной рутинной операцией, которую можно выполнить в любое время **одним кликом**.

## Минимальный пример CD пайплайна  
<img width="728" height="647" alt="image" src="https://github.com/user-attachments/assets/d9c518f6-c6d5-4225-89ca-97c8b82a432f" />

Что здесь происходит:
- test — стейдж CI, проверяем что код работает
- build — создаём Docker-образ и отправляем в реестр
- deploy_staging — автоматически деплоим на тестовый сервер
- deploy_production — готовим деплой в прод, но запускаем **только вручную** (when: manual)

После прохождения всех автоматических стейджей код готов к продакшн-релизу, но кнопку нажимает человек. Это и есть **Continuous Delivery — постоянная готовность к поставке**.  

## Как CD расширяет CI: полная картина  
CI и CD работают вместе, формируя единый конвейер доставки кода от разработчика к пользователю. Давайте посмотрим на полный процесс:
<img width="372" height="494" alt="image" src="https://github.com/user-attachments/assets/613e3c16-4e14-4eca-bdb6-e2607277e13c" />

**CI-часть фокусируется на качестве кода**. **CD-часть фокусируется на подготовке к релизу**. Вместе они обеспечивают быструю и безопасную доставку изменений.

## Артефакты — основа CD  
Центральное понятие в CD — это артефакт. **Артефакт** — это готовый к деплою пакет вашего приложения. Это может быть **Docker-образ, JAR-файл, ZIP-архив, RPM-пакет** — любой формат, который можно развернуть на сервере.  

Важный принцип: **"Build once, deploy many"**. Артефакт собирается **один раз** и затем используется **на всех окружениях**. Никакой пересборки для продакшна! Тот же самый артефакт, который тестировался на стейджинге, идёт в продакшн.  
Это гарантирует, что в продакшн попадёт именно то, что было протестировано.  

Здесь мы создаём архив с собранным приложением и используем его для всех деплоев. Версионирование по SHA коммита позволяет точно знать, какая версия кода где развёрнута.  
<img width="681" height="724" alt="image" src="https://github.com/user-attachments/assets/fbed5073-ec89-4c5b-94a2-758cbae5a17f" />

## Окружения в CD  
CD подразумевает наличие нескольких окружений, через которые проходит код на пути к продакшну. Типичная схема выглядит так:
- **Development (dev)** — самое нестабильное окружение. Сюда деплоится каждый коммит в основную ветку. Здесь могут быть баги, здесь тестируются новые идеи. Разработчики используют его для проверки интеграции.
- **Testing/QA** — окружение для тестировщиков. Более стабильное, чем dev. Сюда попадают изменения, которые прошли базовые проверки. Тестировщики проводят здесь ручное и автоматизированное тестирование.
- **Staging** — копия продакшна. Такое же железо, такие же данные (обезличенные), такие же настройки. Здесь проводится финальная проверка перед релизом. Если работает на стейджинге, должно работать и на продакшне.
- **Production** — боевое окружение, где работают реальные пользователи. Сюда попадает только проверенный код после всех стадий тестирования.

## Стратегии деплоя в CD  
CD не просто копирует файлы на сервер. Современные стратегии деплоя минимизируют риски и позволяют быстро откатиться при проблемах.
**Blue-Green** деплой использует два идентичных окружения. **Blue** — текущий продакшн, **Green** — новая версия. После проверки **Green**, трафик **переключается с Blue на Green**. Если что-то пошло не так, можно мгновенно вернуться на Blue.  

<img width="376" height="292" alt="image" src="https://github.com/user-attachments/assets/069d461c-1107-4060-9b82-71b19589a1ae" />

**Canary** деплой **постепенно переводит** трафик на новую версию. **Сначала 5%** пользователей, **потом 25%**, **потом 50%**, и так далее. Если метрики ухудшаются, деплой останавливается.  
**Rolling** деплой **обновляет реплики приложения по одному**. В кластере из 10 серверов сначала обновляется первый, потом второй, и так далее. Приложение остаётся доступным в течение всего процесса.

## Автоматизация релиз-процессов  
CD автоматизирует не только технические аспекты деплоя, но и организационные процессы вокруг релиза.

Генерация заметок релиза происходит автоматически на основе коммитов и pull request'ов. Больше не нужно вручную собирать информацию о том, что вошло в релиз. CI/CD система знает все изменения между версиями и может сформировать читаемый список.  

Версионирование тоже автоматизируется. Semantic Versioning (MAJOR.MINOR.PATCH) можно вычислять на основе типов коммитов. Ключевое изменение — увеличиваем MAJOR, новая фича — MINOR, багфикс — PATCH. Те самые v1.0.1 и подобные.

Управление конфигурацией становится частью пайплайна. Переменные окружения, секреты, настройки — всё это автоматически применяется при деплое. Никакого ручного редактирования конфигов на сервере.

## Метрики и мониторинг в CD  
CD не заканчивается на деплое. Важная часть — это мониторинг того, что происходит после релиза. Современные CD системы интегрируются с инструментами мониторинга и автоматически отслеживают ключевые метрики.

**Если** после деплоя метрики **ухудшаются** (растёт количество ошибок, падает производительность), система может **автоматически откатить изменения**. Это называется automated rollback и спасает от многих проблем.

## Разница между Continuous Delivery и Continuous Deployment  
Важно понимать разницу между Continuous Delivery и Continuous Deployment. В Continuous Delivery финальный деплой в продакшн требует ручного подтверждения. Человек принимает решение, когда релизить. В Continuous Deployment даже это автоматизировано — если все проверки пройдены, код автоматически идёт в продакшн.

Continuous Delivery подходит большинству компаний. Она даёт контроль над релизами, позволяет учитывать бизнес-факторы (не релизить в пятницу вечером, дождаться маркетинговой кампании). Continuous Deployment **требует очень высокой зрелости процессов** и подходит не всем.

В следующем уроке мы подробно разберём Continuous Deployment — вершину автоматизации, где код попадает к пользователям без какого-либо ручного вмешательства.
